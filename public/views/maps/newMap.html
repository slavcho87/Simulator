 <div ng-init="loadData()">    
    <div id="wrapper">
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <label class="navbar-brand" >RecSim</label>
            </div>
                
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav side-nav">
                    <li class="active"><a href="#/map"><i class="fa fa-map-marker"></i> Maps</a></li>
                    <li><a href="#/simulator"><i class="fa fa-globe"></i> Simulation</a></li>
                    <li><a href="#/evaluations"><i class="fa fa-bar-chart-o"></i> Evaluations</a></li>
                    <li><a href="#/settings"><i class="fa fa-cog"></i> Settings</a></li>
                    <li><a href="#/profile"><i class="fa fa-edit"></i> Profile</a></li>
                    <li><a href="#/" ng-click="exit()"><i class="fa fa-power-off"></i> Exit</a></li>
                </ul>
            </div>
        </nav>

        <div id="page-wrapper">	
            <div class="alert alert-dismissable alert-danger" ng-repeat="errorMsg in errorMsgList">
                <button type="button" 
                        class="close" 
                        data-dismiss="alert" 
                        aria-hidden="true" 
                        ng-click="msgHide(errorMsg)">&times;</button>
                {{errorMsg}}
            </div>      
            
            <div class="alert alert-dismissable alert-success" ng-repeat="msg in msgList">
                <button type="button" 
                        class="close" 
                        data-dismiss="alert" 
                        aria-hidden="true" 
                        ng-click="msgSuccessHide(msg)">&times;</button>
                {{msg}}
            </div>
            
            <ul class="nav nav-tabs">
                <li><a data-toggle="tab" href="#map">Map search</a></li>
                <li class="active"><a data-toggle="tab" href="#/map/newMap">New map</a></li>
            </ul>

            <div class="panel-body">  
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h3 class="panel-title"><i class="fa fa-plus-circle"></i> Basic data </h3>
                    </div>

                    <div class="panel-body">
                        <div class="row">
                            <div class="col-xs-4">
                                <label>Name</label>
                                <input id="mapName" class="form-control" ng-model="map.name" />
                            </div>
                                    
                            <div class="col-xs-4">
                                <label>Type</label>
                                <select id="mapType" ng-model="map.type" class="form-control">
                                    <option value="private">Private</option>
                                    <option value="public">Public</option>
                                </select>
                            </div>
    
                            <div class="col-xs-4">
                                <label>State</label>
                                <select id="mapState" ng-model="map.state" class="form-control">
                                    <option value="draft">Draft</option>
                                    <option value="active">Active</option>
                                </select>
                            </div>
                            
                            <div class="col-xs-12">
                                <br/>
                                <input id="btnSaveMap" type="submit" class="btn btn-primary" value="Save" ng-click="mapSave()">
                            </div>
                    </div>     
                </div>   

            </div>
 
                <div class="panel panel-primary" ng-hide="hideScene">
                    <div class="panel-heading">
                        <h3 class="panel-title"><i class="fa fa-plus-circle"></i> Create scene </h3>
                    </div>

                    <div class="panel-body">
                        <div class="row">
                            <div ng-hide="isStepActivate(1)">
                                <div class="col-xs-12">
                                    <h3>Step 1: Set scene name and select Recommender settings</h3>
                                </div>    
                                
                                <div class="col-xs-6">
                                    <label>Scene name</label>
                                    <input class="form-control" ng-model="scene.name" />
                                </div>

                                <div class="col-xs-6">
                                    <label>Recommender settings</label>
                                    <select class="form-control" ng-model="scene.recommenderSettings">
                                        <option ng-repeat="recommender in recommenderList" 
                                                value="{{recommender._id}}">{{recommender.poolName}}</option>
                                    </select>
                                </div>                            
                            </div>
                            
                            <div ng-hide="isStepActivate(2)">
                                <div class="col-xs-8">
                                    <div class="col-xs-12">
                                        <h3>Step 2: Limitations of the scene</h3>
                                    </div>    

                                    <div class="col-xs-6">
                                        <br/>
                                        <label>Upper left corner: latitude</label>
                                        <input id="initPosLat" class="form-control" ng-model="scene.latitudeULC" disabled/>
                                    </div>

                                    <div class="col-xs-6">
                                        <br/>
                                        <label>Upper left corner: longitude</label>
                                         <input id="initPosLong" class="form-control" ng-model="scene.longitudeULC" disabled/>
                                    </div>        

                                    <div class="col-xs-6">
                                        <br/>
                                        <label>Lower right corner: latitude</label>
                                        <input id="endPosLat" class="form-control" ng-model="scene.latitudeLRC" disabled/>
                                    </div>

                                    <div class="col-xs-6">
                                        <br/>
                                        <label>Lower right corner: longitude</label>
                                         <input id="endPosLong" class="form-control" ng-model="scene.latitudeLRC" disabled/>
                                    </div>                

                                    <div class="col-xs-6">
                                        <div class="radio">
                                            <input type="radio" name="opciones" id="upperLeftCorner" value="upperLeftCorner" checked>
                                            select upper left corner
                                            </input>
                                        </div>
                                    </div>

                                    <div class="col-xs-6">
                                        <div class="radio">
                                            <input type="radio" name="opciones" id="lowerRightCorner" value="lowerRightCorner">
                                            select lower right corner
                                            </input>
                                        </div>                                    
                                    </div>

                                    <div class="col-xs-6">       
                                        <br/>         
                                        <label>City</label>  
                                        <div class="input-group">
                                            <input ng-model="scene.citySearchValue" type="text" class="form-control" placeholder="Search for...">
                                            <span class="input-group-btn">
                                                <button class="btn btn-default" type="button" ng-click="citySearch()">Go!</button>
                                            </span>
                                        </div>
                                    </div>

                                    <div ng-hide="cityList.length==0" class="col-xs-6">
                                        <br/>
                                        <label>Places: </label>    
                                        <select ng-model="scene.selectedCity" name="selectedCity" class="form-control">
                                            <option ng-repeat="city in cityList" value={{city}}>{{city.display_name}}</option>
                                        </select>
                                    </div>                                
                                </div>
                                
                                <div class="col-xs-4">
                                    <br/>
                                    <div id="crearMapa" class="littleMap">
                                    </div>
                                    
                                    <script type="text/javascript">
                                         $(document).ready(function(){
                                             $("select[name=selectedCity]").change(function(){
                                                var searchCitySelected = $("select[name=selectedCity]").val();
                                                searchCitySelected = JSON.parse(searchCitySelected);
                                                limitMap.getView().setCenter(ol.proj.transform([parseFloat(searchCitySelected.lon), parseFloat(searchCitySelected.lat)], 'EPSG:4326', 'EPSG:3857'));
                                            });
                                        });                           
                                        
                                        var limitMap = new ol.Map({
                                            target: 'crearMapa',
                                            layers: [
                                                new ol.layer.Tile({
                                                    source: new ol.source.MapQuest({layer: 'osm'})
                                                })   
                                            ],      
                                            view: new ol.View({            
                                                center: ol.proj.transform([-0.88824, 41.66991], 'EPSG:4326', 'EPSG:3857'),        
                                                zoom: 15        
                                            }),       
                                            controls: ol.control.defaults().extend([      
                                                new ol.control.FullScreen() 
                                            ])        
                                        });

                                        limitMap.on('singleclick', function(evt) { 
                                             var appElement = document.querySelector('[ng-app=app]');
                                             var $scope = angular.element(appElement).scope();
                                             $scope = $scope.$$childHead; 
                                            
                                            var corner = $('input[name=opciones]:checked').val()
                                            var pos = ol.proj.transform(evt.coordinate,'EPSG:3857', 'EPSG:4326');
                                            
                                            if(corner == "upperLeftCorner"){
                                                $('#initPosLat').val(pos[0]);
                                                $scope.scene.latitudeULC = pos[0];
                                                
                                                $('#initPosLong').val(pos[1]);
                                                $scope.scene.longitudeULC = pos[1];
                                                
                                            }else if(corner == "lowerRightCorner"){
                                                $('#endPosLat').val(pos[0]);
                                                $scope.scene.latitudeLRC = pos[0];
                                                
                                                $('#endPosLong').val(pos[1]);
                                                $scope.scene.longitudeLRC = pos[1];
                                            }else{
                                                alert("Invalid option");
                                            }
                                        });
                                    </script>    
                                         
                                </div>                       
                            </div>                            


                            <div ng-hide="isStepActivate(3)">
                                <div class="col-xs-8">
                                    <div class="col-xs-12">
                                        <h3>Step 3: Static items settings</h3>
                                    </div>

                                    <div class="col-xs-12">
                                        <label>Define items form ...</label>
                                        <select ng-model="scene.defineForm" class="form-control">
                                            <option value="loadFromFile">Load from file</option>
                                            <option value="setManually">Set manually</option>
                                        </select>
                                    </div>

                                    <div ng-hide="loadFromFileSelected()">
                                        <!-- cuando cargamos los objetos desde un fichero de texto -->

                                        <div class="col-xs-12">
                                            <br/>
                                            <label>Static items</label>    
                                            <input type="file" name="staticItemFile" id="staticItemFile" ng-model="scene.staticItemFile">     
                                            <b>
                                                <i>* File containing these static objects on the map, that is, don't 
                                                    changing geographical position during the simulation
                                                </i>
                                            </b>
                                        </div>

                                        <div class="col-xs-12">
                                            <br/>
                                            <button type="button" 
                                                    class="btn btn-success" 
                                                    ng-click="loadStaticItemsFromFile()"
                                                    data-toggle="modal" data-target="#viewStaticItemModal">
                                                Load static items
                                            </button>
                                        </div>    
                                    </div>
                                    

                                    <div ng-hide="setManuallySelected()">
                                        <!-- cuando tenemos que definir los objetos de forma manual en el mapa -->
                                        <div class="col-xs-3">
                                            <br/>
                                             <label>Static item type</label>
                                             <select class="form-control" ng-model="newStaticItem.type">
                                                <option ng-repeat="staticItem in staticItemList" value="{{staticItem}}">
                                                    {{staticItem.name}}
                                                 </option>
                                            </select>
                                        </div>

                                        <div class="col-xs-3">
                                            <br/>
                                            <label>Item name</label>
                                            <input ng-model="newStaticItem.name" class="form-control"/>
                                        </div>    

                                        <div class="col-xs-3">
                                            <br/>
                                            <label>Longitude</label>
                                            <input id="staticItemLong" class="form-control" ng-model="newStaticItem.longitude" disabled/>
                                        </div>

                                        <div class="col-xs-3">
                                            <br/>
                                            <label>Latitude</label>
                                            <input id="staticItemLat" class="form-control" ng-model="newStaticItem.latitude" disabled/>
                                        </div>
                                        
                                        <div class="col-xs-12">
                                            <label>Description</label>
                                            <textarea class="form-control" ng-model="newStaticItem.description" rows="3"></textarea>
                                        </div>

                                        <div class="col-xs-12">
                                            <br/>
                                            <button type="button" class="btn btn-success" onclick="saveStaticItem()" ng-click="saveStaticItemInScene()">Save item</button>
                                        </div>    
                                    </div>                       
                                </div>
                                    
                                <div class="col-xs-4">
                                    <br/>
                                    <div id="staticItemsMap" class="littleMap">
                                    </div>

                                    <script type="text/javascript">
                                                var overlayList = {};
                                                var index = 0;

                                                var staticItemsMap = new ol.Map({
                                                    target: 'staticItemsMap',
                                                    layers: [
                                                        new ol.layer.Tile({
                                                            source: new ol.source.MapQuest({layer: 'osm'})
                                                        })   
                                                    ],      
                                                    view: new ol.View({            
                                                        center: ol.proj.transform([-0.88824, 41.66991], 'EPSG:4326', 'EPSG:3857'),        
                                                        zoom: 15           
                                                    }),       
                                                    controls: ol.control.defaults().extend([      
                                                        new ol.control.FullScreen() 
                                                    ])        
                                                });

                                                staticItemsMap.on('singleclick', function(evt) { 
                                                    var position = ol.proj.transform(evt.coordinate,'EPSG:3857', 'EPSG:4326');
                                                    var appElement = document.querySelector('[ng-app=app]');
                                                    var $scope = angular.element(appElement).scope();
                                                    $scope = $scope.$$childHead; 

                                                    if(overlayList[index]){
                                                        staticItemsMap.removeOverlay(overlayList[index]); 
                                                    }

                                                    var staticItemType = JSON.parse($scope.newStaticItem.type);
                                                    overlayList[index] = new ol.Overlay({
                                                        position: evt.coordinate,
                                                        element: $('<img src="'+staticItemType.icon+'" class="img-circle">')
                                                        .css({marginTop: '-50%', marginLeft: '-50%', width: '40px', height: '40px', cursor: 'pointer'})
                                                    });

                                                    $('#staticItemLat').val(position[0]);
                                                    $('#staticItemLong').val(position[1]);

                                                    staticItemsMap.addOverlay(overlayList[index]);

                                                    $scope.$apply(function () {
                                                        $scope.newStaticItem.latitude = position[0];    
                                                        $scope.newStaticItem.longitude = position[1];
                                                    });
                                                });

                                                function saveStaticItem(){
                                                    index++;
                                                }
                                    </script>                            
                                </div>
                                
                                <div class="col-xs-12" ng-show="staticItemListInScene.length>0">
                                    <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>
                                                        <button type="button" class="btn btn-success fa fa-check" ng-click="checkAll()"></button>
                                                        <button type="button" class="btn btn-success fa fa-times" ng-click="uncheckAll()"></button>
                                                        <button type="button" class="btn btn-success fa fa-tags" data-toggle="modal" data-target="#setStaticItemTypeModal" ng-show="staticItemSelected.length>0"></button>
                                                        <button type="button" class="btn btn-danger fa fa-trash-o" data-toggle="modal" data-target="#deleteSelectedStaticItemsModal" ng-show="staticItemSelected.length>0"></button>
                                                    </th>
                                                    <th>Item name</th>
                                                    <th>Item type</th>
                                                    <th>Icon</th>
                                                    <th>Description</th>
                                                    <th>Options</th>
                                                </tr>
                                            </thead>
                                            <tbody ng-repeat="staticItemElement in staticItemListInScene 
                                                              | startFrom:currentPageStaticItems*pageSizeStaticItems 
                                                              | limitTo:pageSizeStaticItems">
                                                <tr>
                                                    <td><input type="checkbox" checklist-model="staticItemSelected" checklist-value="staticItemElement"></td>
                                                    <td>{{staticItemElement.name}}</td>
                                                    <td>
                                                        <a href="#/map/newMap" 
                                                           editable-select="staticItemElement.type" 
                                                           e-ng-options="staticItem as staticItem.name for staticItem in staticItemList">
                                                            {{staticItemElement.type.name || "empty"}}
                                                        </a>
                                                    </td>
                                                    <td><img src="{{staticItemElement.type.icon}}" height="16" width="16"/></td>
                                                    <td>{{staticItemElement.description}}</td>
                                                    <td>
                                                        <button class="btn btn-danger fa fa-trash-o" 
                                                                data-toggle="modal" data-target="#deleteStaticItemModal"
                                                                ng-click="selectStaticItemToDeleteFromScene(staticItemElement, $index)"></button>
                                                    </td> 
                                                </tr>
                                            </tbody>
                                    </table>

                                    <nav align="center">
                                        <ul class="pagination">
                                            <li ng-disabled="currentPageStaticItems == 0">
                                                <a href="#/map/newMap" 
                                                   ng-click="previousStaticItems()"
                                                   aria-label="Previous">
                                                   <span aria-hidden="true">&laquo;</span>
                                                </a>
                                            </li>

                                            <li ng-repeat="pag in pagesStaticItems()" ng-class="{active:pag==currentPageStaticItems}">
                                                <a href="#/map/newMap" ng-click="setCurrentPageStaticItems(pag)">{{pag+1}}</a>
                                            </li>

                                            <li>
                                                <a href="#/map/newMap"    
                                                  ng-click="nextStaticItems()"
                                                  aria-label="Next">  
                                                  <span aria-hidden="true">&raquo;</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </nav>                                          
                                </div>
                            </div>
                            
                            <div ng-hide="isStepActivate(4)">
                                <div class="col-xs-8">
                                    <div class="col-xs-12">
                                        <h3>Step 4: Dynamic items settings</h3>
                                    </div>

                                    <div class="col-xs-12">
                                        <label>Define items form ...</label>
                                        <select ng-model="scene.defineFormFileDynamicItem" class="form-control">
                                            <option value="loadFromFileDynamicItem">Load from file</option>
                                            <option value="setManuallyDynamicItem">Set manually</option>
                                            <option value="setRandom">Random trajectory</option>
                                        </select>
                                    </div>

                                    <div ng-hide="loadFromFileSelectedDynamicItem()">
                                        <!-- cuando cargamos los objetos desde un fichero de texto -->

                                        <div class="col-xs-12">           
                                            <br/>      
                                            <label>Dynamic items</label>
                                            <input type="file" name="dynamicItemFile" id="dynamicItemFile" ng-model='scene.dynamicItemFile'>      
                                            <b>
                                                <i>* File containing dynamic objects of the map, that is, the changing 
                                                geographic position during the simulation such as automobiles
                                                </i>
                                            </b>   
                                        </div>
                                        <div class="col-xs-12">
                                            <br/>
                                            <button type="button" 
                                                    class="btn btn-success" 
                                                    ng-click="loadDynamicItemsFromFile()"
                                                    data-toggle="modal" data-target="#viewDynamicItemModal">
                                                Load dynamic items
                                            </button>
                                        </div> 
                                    </div>

                                    <div ng-hide="setManuallySelectedDynamicItem()">                                
                                        <br/>
                                        <div class="col-xs-3">
                                            <br/>
                                            <label>Dynamic item type</label>
                                            <select class="form-control" ng-model="newDynamicItem.type">
                                                <option ng-repeat="dynamicItem in dynamicItemList" value="{{dynamicItem}}">
                                                    {{dynamicItem.name}}
                                                 </option>
                                            </select>
                                        </div>

                                        <div class="col-xs-3">
                                            <br/>
                                            <label>Item name</label>
                                            <input ng-model="newDynamicItem.dynamicItemName" class="form-control"/>
                                        </div>

                                        <div class="col-xs-3">
                                            <br/>
                                            <label>Item speed (km/h)</label>
                                            <input ng-model="newDynamicItem.itemSpeed" class="form-control"/>
                                        </div>
                                        
                                        <div class="col-xs-12">
                                            <label>Description: </label>
                                            <textarea class="form-control" ng-model="newDynamicItem.description" rows="3"></textarea>
                                        </div>
                                        
                                        <div class="col-xs-3">
                                            <br/><br/>
                                            <button type="button" class="btn btn-success" ng-click="saveDynamicItemInScene()">Save item</button>
                                        </div>

                                        <div class="col-xs-12" ng-show="newDynamicItem.route.length>0">
                                            <table class="table table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>Order</th>
                                                        <th>Longitude</th>
                                                        <th>Latitude</th>
                                                        <th>Optiones</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr ng-repeat="point in newDynamicItem.route
                                                                    | startFrom:currentPageDynaicItemsMan*pageSizeDynaicItemsMan 
                                                                    | limitTo:pageSizeDynaicItemsMan">
                                                        <td>{{newDynamicItem.route.indexOf(point)+1}}</td>
                                                        <td>{{point.long}}</td>
                                                        <td>{{point.lat}}</td>
                                                        <td>
                                                            <button class="btn btn-danger fa fa-trash-o" 
                                                                    data-toggle="modal" data-target="#deletePointFromRouteModal"
                                                                    ng-click="selectPointToDelete(point)"></button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            
                                            <nav align="center">
                                                <ul class="pagination">
                                                    <li ng-disabled="currentPageDynaicItemsMan == 0">
                                                        <a href="#/map/newMap" 
                                                           ng-click="previousDynaicItemsMan()"
                                                           aria-label="Previous">
                                                           <span aria-hidden="true">&laquo;</span>
                                                        </a>
                                                    </li>

                                                    <li ng-repeat="pag in pagesDynaicItemsMan()" ng-class="{active:pag==currentPageDynaicItemsMan}">
                                                        <a href="#/map/newMap" ng-click="setCurrentPageDynaicItemsMan(pag)">{{pag+1}}</a>
                                                    </li>

                                                    <li>
                                                        <a href="#/map/newMap"    
                                                          ng-click="nextDynaicItemsMan()"
                                                          aria-label="Next">  
                                                          <span aria-hidden="true">&raquo;</span>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </nav>
                                        </div>
                                    </div>

                                    <div ng-hide="setRandomWay()">
                                        <br/>
                                        <div class="col-xs-3">
                                            <br/>
                                            <label>Dynamic item type</label>
                                            <select class="form-control" ng-model="newDynamicItem.type">
                                                <option ng-repeat="dynamicItem in dynamicItemList" value="{{dynamicItem}}">
                                                    {{dynamicItem.name}}
                                                 </option>
                                            </select>
                                        </div>

                                        <div class="col-xs-3">
                                            <br/>
                                            <label>Number of items</label>
                                             <input ng-model="randomWay.numberDynamicItems" class="form-control"/>
                                        </div>  

                                        <div class="col-xs-3">
                                            <br/>
                                            <label>Way type</label>
                                            <select class="form-control" ng-model="randomWay.wayType">
                                                <option value="motorway">motorway</option>
                                                <option value="trunk">trunk</option>
                                                <option value="primary">primary</option>
                                                <option value="secondary">secondary</option>
                                                <option value="tertiary">tertiary</option>
                                                <option value="unclassified">unclassified</option>
                                                <option value="residential">residential</option>
                                                <option value="service">service</option>
                                            </select>                                         
                                        </div>

                                         <div class="col-sm-3">
                                             <br/><br/>
                                             <button ng-show="loadRandomWay" type="button" class="btn btn-primary btn-block" ng-click="generateRandomWay()">Generate random way</button>
                                        </div>
                                                                        
                                        <div class="col-sm-12">
                                            <div ng-show="!loadRandomWay">
                                                <img src="/images/loader.gif">
                                                <label>Generating trajectory. This process can take several minutes. Please wait ...</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-xs-4">
                                    <br/>
                                    <div id="dynamicItemsMap" class="littleMap">
                                    </div>

                                    <script type="text/javascript">
                                        var dynamicItemsMap = new ol.Map({
                                            target: 'dynamicItemsMap',
                                            layers: [
                                                new ol.layer.Tile({
                                                    source: new ol.source.MapQuest({layer: 'osm'})
                                                })   
                                            ],      
                                            view: new ol.View({            
                                                center: ol.proj.transform([-0.88824, 41.66991], 'EPSG:4326', 'EPSG:3857'),        
                                                zoom: 15           
                                            }),       
                                            controls: ol.control.defaults().extend([      
                                                new ol.control.FullScreen() 
                                            ])        
                                        });    
                                        
                                        dynamicItemsMap.on('singleclick', function(evt) {
                                            var pos = ol.proj.transform(evt.coordinate,'EPSG:3857', 'EPSG:4326');
                                            var appElement = document.querySelector('[ng-app=app]');
                                            var $scope = angular.element(appElement).scope();
                                            $scope = $scope.$$childHead; 
                                            
                                            var pointMap = new ol.Overlay({
                                                position: evt.coordinate,
                                                element: $('<img src="images/map-pin-md.png" class="img-circle" id="'+pos+'">')
                                                .css({marginTop: '-150%', marginLeft: '-50%', width: '40px', height: '40px', cursor: 'pointer'})    
                                            });
                                            
                                            dynamicItemsMap.addOverlay(pointMap);
                                            
                                            $scope.$apply(function () {
                                                $scope.newDynamicItem.route.push({
                                                    long: pos[1],  
                                                    lat: pos[0] 
                                                });
                                            });
                                        });
                                    </script>
                                </div>
                                
                                <div class="col-xs-12" ng-show="dynamicItemListInScene.length>0">                                        
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>
                                                        <button type="button" class="btn btn-success fa fa-check" ng-click="checkAllDynamicItem()"></button>
                                                        <button type="button" class="btn btn-success fa fa-times" ng-click="uncheckAllDynamicItem()"></button>
                                                        <button type="button" class="btn btn-success fa fa-tags" data-toggle="modal" data-target="#setItemTypeModal" ng-show="dynamicItemSelected.length>0"></button>
                                                        <button type="button" class="btn btn-success fa fa-road" data-toggle="modal" data-target="#generateTrajectoryModal" ng-show="dynamicItemSelected.length>0"></button>
                                                        <button type="button" class="btn btn-danger fa fa-trash-o" data-toggle="modal" data-target="#deleteSelectedDynamicItemsModal" ng-show="dynamicItemSelected.length>0"></button>
                                                    </th>
                                                    <th>Item name</th>
                                                    <th>Item type</th>
                                                    <th>Speed</th>
                                                    <th>Icon</th>
                                                    <th>Description</th>
                                                    <th>Options</th>
                                                </tr>
                                            </thead>
                                            <tbody ng-repeat="dynamicItem in dynamicItemListInScene 
                                                              | startFrom:currentPageDynaicItems*pageSizeDynaicItems  
                                                              | limitTo:pageSizeDynaicItems">
                                                <tr>
                                                    <td><input type="checkbox" checklist-model="dynamicItemSelected" checklist-value="dynamicItem"></td>
                                                    <td>{{dynamicItem.name}}</td>
                                                    <td>    
                                                        <a href="#/map/newMap"
                                                           editable-select="dynamicItem.type" 
                                                           e-ng-options="item as item.name for item in dynamicItemList">
                                                            {{dynamicItem.type.name || "empty"}}
                                                        </a>
                                                    </td>
                                                    <td>{{dynamicItem.speed}}</td>
                                                    <td><img src="{{dynamicItem.type.icon}}" height="16" width="16"/></td>
                                                    <td>{{dynamicItem.description}}</td>
                                                    <td>
                                                        <button class="btn btn-success fa fa-road"
                                                                data-toggle="modal" data-target="#importTrajectoryModal"
                                                                ng-click="setImportTrajectorySelected(dynamicItem)"></button>
                                                        <button class="btn btn-danger fa fa-trash-o"
                                                                data-toggle="modal" data-target="#deleteDynamicItemModal"
                                                                ng-click="selectDynamicItemToDelete(dynamicItem)"></button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        
                                        <nav align="center">
                                                <ul class="pagination">
                                                    <li ng-disabled="currentPageDynaicItems == 0">
                                                        <a href="#/map/newMap" 
                                                           ng-click="previousDynaicItems()"
                                                           aria-label="Previous">
                                                           <span aria-hidden="true">&laquo;</span>
                                                        </a>
                                                    </li>

                                                    <li ng-repeat="pag in pagesDynaicItems()" ng-class="{active:pag==currentPageDynaicItems}">
                                                        <a href="#/map/newMap" ng-click="setCurrentPageDynaicItems(pag)">{{pag+1}}</a>
                                                    </li>

                                                    <li>
                                                        <a href="#/map/newMap"    
                                                          ng-click="nextDynaicItems()"
                                                          aria-label="Next">  
                                                          <span aria-hidden="true">&raquo;</span>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </nav>
                                    </div>                               
                    
                                <div class="col-sm-12">
                                    <br/>
                                    <button type="button" class="btn btn-primary btn-block" ng-click="saveScene()">Save</button>
                                </div>
                            </div>                            
                                                  
                    
                            <div class="col-xs-12">
                                <nav align="center">
                                  <ul class="pagination">
                                    <li ng-class="{active:!isStepActivate('1')}">
                                        <a href="#/map/newMap" ng-click="setStep(1)">Step 1</a>
                                    </li>
                                    <li ng-class="{active:!isStepActivate('2')}">
                                        <a href="#/map/newMap" ng-click="setStep(2)">Step  2</a>
                                    </li>
                                    <li ng-class="{active:!isStepActivate('3')}">
                                        <a href="#/map/newMap" ng-click="setStep(3)">Step  3</a>
                                    </li>
                                    <li ng-class="{active:!isStepActivate('4')}">
                                        <a href="#/map/newMap" ng-click="setStep(4)">Step  4</a>
                                    </li>
                                  </ul>
                                </nav>    
                            </div>
                            
                    </div>     
                </div>                         
        </div>   

                <div class="panel panel-primary table-responsive" ng-hide="hideScene" ng-hide="sceneList.length==0">
                    <div class="panel-heading">
                        <h3 class="panel-title"><i class="fa fa-list-alt"></i> List of scenes for this map</h3>
                    </div>
                    
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Scene name</th>
                                    <th>Creation date</th>
                                    <th>Recommender settings</th>
                                    <th>Number of static items</th>
                                    <th>Number of dynamic items</th>
                                    <th></th>
                                </tr>
                            </thead>
                            
                            <tbody>
                                <tr ng-repeat="scene in sceneList | startFrom:currentPage*pageSize | limitTo:pageSize">
                                    <td>{{scene.sceneName}}</td>
                                    <td>{{scene.creationDate}}</td>
                                    <td>{{scene.recommenderSettings}}</td>
                                    <td>{{scene.staticItemNumber}}</td>
                                    <td>{{scene.dynamicItemNumber}}</td>
                                    <td>
                                        <button class="btn btn-primary fa fa-pencil-square-o" 
                                                ng-click="editScene(scene)"></button>
                                        
                                        <button class="btn btn-danger fa fa-trash-o" 
                                                data-toggle="modal" 
                                                data-target="#deleteSceneModal"
                                                ng-click="selectSceneToDelete(scene)"></button>
                                    </td> 
                                </tr>
                            </tbody>
                        </table>
                    
                        <nav align="center">
                            <ul class="pagination">
                                <li ng-disabled="currentPage == 0">
                                    <a href="#/map/newMap" 
                                       ng-click="previous()"
                                       aria-label="Previous">
                                       <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>

                                <li ng-repeat="pag in pages()" ng-class="{active:pag==currentPage}">
                                    <a href="#/map/newMap" ng-click="setCurrentPage(pag)">{{pag+1}}</a>
                                </li>

                                <li>
                                  <a href="#/map/newMap" 
                                     ng-click="next()"
                                     aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                  </a>
                                </li>
                            </ul>
                        </nav>
                </div>
            </div>
		</div>
	</div>	
</div>

        <!-- Delete map Modal -->
        <div class="modal fade" role="dialog" id="deleteSceneModal">
          <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Confirmation</h4>
              </div>
                
              <div class="modal-body">
                <p>Are you sure you want to delete this scene?</p>
              </div>
                
              <div class="modal-footer">  
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal" ng-click="deleteScene()">Delete</button>  
              </div>
            </div>

          </div>
        </div>

        <div class="modal fade" role="dialog" id="deleteDynamicItemModal">
          <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Confirmation</h4>
              </div>
                
              <div class="modal-body">
                <p>Are you sure you want to delete this item?</p>
              </div>
                
              <div class="modal-footer">  
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal" ng-click="deleteDynamicItemFromScene()">Delete</button>  
              </div>
            </div>

          </div>
        </div>

        <div class="modal fade" role="dialog" id="deletePointFromRouteModal">
          <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Confirmation</h4>
              </div>
                
              <div class="modal-body">
                <p>Are you sure you want to delete this point?</p>
              </div>
                
              <div class="modal-footer">  
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal" ng-click="deletePointFromRoute()">Delete</button>  
              </div>
            </div>

          </div>
        </div>

        <!-- Delete static item Modal -->
        <div class="modal fade" role="dialog" id="deleteStaticItemModal">
          <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Confirmation</h4>
              </div>
                
              <div class="modal-body">
                <p>Are you sure you want to delete this static item?</p>
              </div>
                
              <div class="modal-footer">  
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal" ng-click="deleteStaticItemFromScene()">Delete</button>  
              </div>
            </div>

          </div>
        </div>


        <div class="modal fade" role="dialog" id="deleteDynamicItemModal">
          <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Confirmation</h4>
              </div>
                
              <div class="modal-body">
                <p>Are you sure you want to delete this item?</p>
              </div>
                
              <div class="modal-footer">  
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal" ng-click="deleteDynamicItemFromScene()">Delete</button>  
              </div>
            </div>

          </div>
        </div>

        <div class="modal fade" role="dialog" id="viewDynamicItemModal">
          <div class="modal-dialog modal-lg">

            <!-- Modal content-->
            <div class="modal-content2">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Data Preview</h4>
              </div>
                
              <div class="modal-body">  
                  <div class="row">      
                      <div class="col-sm-6">
                          <label>Delimiter</label>
                          <select class="form-control" ng-model="dataPreviewDynamicItemDelimiter" ng-change="setDelimiter()">
                            <option value="tab">Tab</option>
                            <option value="comma">Comma</option>
                            <option value="space">Space</option>
                          </select>
                      </div>
                      
                      <div class="col-sm-6">
                          <label>Item name</label>
                          <select class="form-control" ng-model="dataPreviewDynamicItemItemName">
                                <option ng-repeat="column in previewDynamicItemColumnSplit" 
                                                value="{{column}}">{{column}}</option>
                          </select>
                      </div>
                      
                      <div class="col-sm-6">
                          <label>Item speed (km/h)</label>
                          <select class="form-control" ng-model="dataPreviewDynamicItemItemSpeed">
                                <option ng-repeat="column in previewDynamicItemColumnSplit" 
                                                value="{{column}}">{{column}}</option>
                          </select>
                      </div>
                      
                      <div class="col-sm-6">
                          <label>Description</label>
                          <select class="form-control" ng-model="dataPreviewDynamicItemDescription">
                                <option ng-repeat="column in previewDynamicItemColumnSplit" 
                                                value="{{column}}">{{column}}</option>
                          </select>
                      </div>
                      
                      <div class="col-sm-12">
                            <label>Dynamic item type</label>
                          <select class="form-control" ng-model="newDynamicItem.type">
                              <option ng-repeat="dynamicItem in dynamicItemList" value="{{dynamicItem}}">
                                  {{dynamicItem.name}}    
                              </option>
                          </select>
                      </div>
                      
                      <div class="col-sm-12">
                          <br/>
                          <table class="table table-striped">
                                  <thead>
                                        <tr>
                                            <th ng-repeat="column in previewDynamicItemColumnSplit">{{column}}</th>
                                        </tr>
                                   </thead>
                                    <tbody>
                                        <tr ng-repeat="rows in previewDynamicItemRowsSplit track by $index">
                                            <td ng-repeat="row in rows track by $index">{{row}}</td>
                                        </tr>
                                    </tbody>
                          </table>                  
                      </div>
                  </div>
              </div>
                
              <div class="modal-footer">  
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" data-dismiss="modal" ng-click="importDynamicData()">Import</button>  
              </div>
            </div>

          </div>
        </div>


        <div class="modal fade" role="dialog" id="viewStaticItemModal">
          <div class="modal-dialog modal-lg">

            <!-- Modal content-->
            <div class="modal-content2">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Data Preview</h4>
              </div>
                
              <div class="modal-body">  
                  <div class="row">      
                      <div class="col-sm-6">
                          <label>Delimiter</label>
                          <select class="form-control" ng-model="dataPreviewDynamicItemDelimiter" ng-change="setDelimiter()">
                            <option value="tab">Tab</option>
                            <option value="comma">Comma</option>
                            <option value="space">Space</option>
                          </select>
                      </div>
                      
                      <div class="col-sm-6">
                          <label>Item name</label>
                          <select class="form-control" ng-model="dataPreviewStaticItemName">
                                <option ng-repeat="column in previewDynamicItemColumnSplit" 
                                                value="{{column}}">{{column}}</option>
                          </select>
                      </div>
                      
                       <div class="col-sm-6">
                          <label>Longitude</label>
                          <select class="form-control" ng-model="dataPreviewStaticItemLong">
                                <option ng-repeat="column in previewDynamicItemColumnSplit" 
                                                value="{{column}}">{{column}}</option>
                          </select>
                      </div>
                      
                      <div class="col-sm-6">
                          <label>Latitude</label>
                          <select class="form-control" ng-model="dataPreviewStaticItemLat">
                                <option ng-repeat="column in previewDynamicItemColumnSplit" 
                                                value="{{column}}">{{column}}</option>
                          </select>
                      </div>
                      
                      <div class="col-sm-6">
                          <label>Description</label>
                          <select class="form-control" ng-model="dataPreviewStaticItemDesc">
                                <option ng-repeat="column in previewDynamicItemColumnSplit" 
                                                value="{{column}}">{{column}}</option>
                          </select>
                      </div>
                      
                      <div class="col-sm-6">
                          <label>Static item type</label>
                          <select class="form-control" ng-model="newStaticItem.type">
                            <option ng-repeat="staticItem in staticItemList" value="{{staticItem}}">
                               {{staticItem.name}}
                            </option>
                        </select>
                      </div>
                      
                      <div class="col-sm-12">
                          <br/>
                          <table class="table table-striped">
                                  <thead>
                                        <tr>
                                            <th ng-repeat="column in previewDynamicItemColumnSplit">{{column}}</th>
                                        </tr>
                                   </thead>
                                    <tbody>
                                        <tr ng-repeat="rows in previewDynamicItemRowsSplit track by $index">
                                            <td ng-repeat="row in rows track by $index">{{row}}</td>
                                        </tr>
                                    </tbody>
                          </table>              
                      </div>
                  </div>
              </div>
                
              <div class="modal-footer">  
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" data-dismiss="modal" ng-click="importStaticData()">Import</button>  
              </div>
            </div>

          </div>
        </div>

        <div class="modal fade" role="dialog" id="importTrajectoryModal">
          <div class="modal-dialog modal-lg">

            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Import trajectory</h4>
              </div>
                
              <div class="modal-body">  
                  <div class="row">      
                      <div class="col-xs-12">           
                            <br/>      
                            <label>Trajectory file</label>
                            <input type="file" name="trajectoryFile" id="trajectoryFile" ng-model='trajectoryFile'>      
                            <b>
                                <i>* The file contains the way of a dynamic object</i>
                            </b>   
                      </div>
                      <div class="col-xs-12">
                            <button type="button" class="btn btn-success" ng-click="loadFileTrajectory()">Load trajectory</button>            
                      </div>
    
                      <div class="col-sm-6" ng-show="previewDynamicItemRowsSplit.length>0">
                          <label>Delimiter</label>
                          <select class="form-control" ng-model="dataPreviewDynamicItemDelimiter" ng-change="setDelimiter()">
                            <option value="tab">Tab</option>
                            <option value="comma">Comma</option>
                            <option value="space">Space</option>
                          </select>
                      </div>
                      
                      <div class="col-xs-6" ng-show="previewDynamicItemRowsSplit.length>0">
                        <label>Speed (km/h)</label>    
                        <input class="form-control" ng-value="importTrajectorySelected.speed"/>    
                      </div>
                      
                      <div class="col-sm-6" ng-show="previewDynamicItemRowsSplit.length>0">
                          <label>longitude</label>
                          <select class="form-control" ng-model="dataPreviewDynamicItemLong">
                                <option ng-repeat="column in previewDynamicItemColumnSplit" 
                                                value="{{column}}">{{column}}</option>
                          </select>
                      </div>
                      
                      <div class="col-sm-6" ng-show="previewDynamicItemRowsSplit.length>0">
                          <label>Latitude</label>
                          <select class="form-control" ng-model="dataPreviewDynamicItemLat">
                                    <option ng-repeat="column in previewDynamicItemColumnSplit" 
                                                    value="{{column}}">{{column}}</option>
                          </select>
                      </div>
                      
                      <div class="col-sm-12">
                          <br/>
                          <table class="table table-striped">
                                  <thead>
                                        <tr>
                                            <th ng-repeat="column in previewDynamicItemColumnSplit">{{column}}</th>
                                        </tr>
                                   </thead>
                                    <tbody>
                                        <tr ng-repeat="rows in previewDynamicItemRowsSplit track by $index">
                                            <td ng-repeat="row in rows track by $index">{{row}}</td>
                                        </tr>
                                    </tbody>
                          </table>              
                      </div>
                  </div>
              </div>
                
              <div class="modal-footer">  
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" data-dismiss="modal" ng-click="importTrajectory()">Import</button>  
              </div>
            </div>

          </div>
        </div>

    <div class="modal fade" role="dialog" id="setItemTypeModal">
          <div class="modal-dialog modal-lg">

            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Assign item type to select items</h4>
              </div>
                
              <div class="modal-body">  
                  <div class="row">
                      <div class="col-xs-12">      
                          <label>Dynamic item type</label>
                          <select class="form-control" ng-model="newDynamicItem.type">
                              <option ng-repeat="dynamicItem in dynamicItemList" value="{{dynamicItem}}">
                                  {{dynamicItem.name}}    
                              </option>
                          </select>   
                      </div>
                  </div>
              </div>
                
              <div class="modal-footer">  
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" data-dismiss="modal" ng-click="addDynacmiItemType()">Save item type</button>  
              </div>
            </div>

          </div>
        </div>

    <div class="modal fade" role="dialog" id="generateTrajectoryModal">
          <div class="modal-dialog modal-lg">

            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Generate random way to select items</h4>
              </div>
                
              <div class="modal-body">  
                  <div class="row">      
                      <div class="col-xs-6">
                          <label>Way type</label>
                          <select class="form-control" ng-model="randomWay.wayType">
                              <option value="motorway">motorway</option>
                              <option value="trunk">trunk</option>
                              <option value="primary">primary</option>
                              <option value="secondary">secondary</option>
                              <option value="tertiary">tertiary</option>
                              <option value="unclassified">unclassified</option>
                              <option value="residential">residential</option>
                              <option value="service">service</option>    
                          </select>           
                      </div>
                                            
                      <div class="col-xs-6">              
                          <br/>                
                          <button ng-show="loadRandomWay" type="button" class="btn btn-primary btn-block" ng-click="generateRandomWayToSet()">Generate random way</button>
                                        
                          <div ng-show="!loadRandomWay">
                              <img src="/images/loader.gif">
                              <label>Generating trajectory. This process can take several minutes. Please wait ...</label>                
                          </div>       
                      </div>   
                  </div>
              </div>
                
              <div class="modal-footer">  
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
              </div>
            </div>

          </div>
        </div>

        <div class="modal fade" role="dialog" id="setStaticItemTypeModal">
          <div class="modal-dialog modal-lg">

            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Assign static item type</h4>
              </div>
                
              <div class="modal-body">  
                  <div class="row">      
                      <div class="col-xs-6">
                          <label>Static item type</label>
                          <select class="form-control" ng-model="newStaticItem.type">
                              <option ng-repeat="staticItem in staticItemList" value="{{staticItem}}">
                                  {{staticItem.name}}
                              </option>
                          </select>
                      </div>                        
                  </div>
              </div>
        
              <div class="modal-footer">  
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" data-dismiss="modal" ng-click="addItemType()">Save item type</button> 
              </div>
            </div>

          </div>
        </div>

        <div class="modal fade" role="dialog" id="deleteSelectedStaticItemsModal">
          <div class="modal-dialog modal-lg">

            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Confirmation</h4>
              </div>
                
              <div class="modal-body">  
                  <div class="row">      
                      <div class="col-xs-6">
                          <label>Are you sure you want to delete the selected items?</label>
                      </div>                        
                  </div>
              </div>
        
              <div class="modal-footer">  
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal" ng-click="deleteSelectedStaticItems()">Delete</button> 
              </div>
            </div>

          </div>
        </div>

        <div class="modal fade" role="dialog" id="deleteSelectedDynamicItemsModal">
          <div class="modal-dialog modal-lg">

            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Confirmation</h4>
              </div>
                
              <div class="modal-body">  
                  <div class="row">      
                      <div class="col-xs-6">
                          <label>Are you sure you want to delete the selected items?</label>
                      </div>                        
                  </div>
              </div>
        
              <div class="modal-footer">  
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal" ng-click="deleteSelectedDynamicItems()">Delete</button> 
              </div>
            </div>

          </div>
        </div>
